{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bill of Supply</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        color: #000;
        font-size: 14px;
    }
    .container {
        width: 800px;
        margin: auto;
        padding: 20px;
        border: 1px solid #aaa;
    }
    h2, h3 {
        margin: 5px 0;
        text-align: center;
    }
    .header, .footer {
        text-align: center;
        font-size: 12px;
        margin-bottom: 15px;
    }
    .row {
        display: flex;
        justify-content: space-between;
    }
    .col {
        width: 48%;
        border: 1px solid #ddd;
        padding: 10px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    table th, table td {
        border: 1px solid #444;
        padding: 8px;
        text-align: center;
    }
    .totals {
        margin-top: 20px;
        width: 100%;
    }
    .totals td {
        padding: 6px;
    }
    .signature {
        margin-top: 30px;
        text-align: right;
        font-weight: bold;
    }
    .note {
        font-size: 12px;
        margin-top: 15px;
    }
</style>
</head>
<body>

<div class="container">

    <div class="row">
        <div>
            <img style="height: 130px;" src="{%static 'img/jaan_logo.jpeg' %}">
        </div>
        <div>
            <h3>BILL OF SUPPLY - RETAIL</h3>
            <strong>No:</strong> {{ sale.receipt_no }}<br>
            <strong>Date:</strong> {{ sale.sales_date|date:"d/m/Y" }}<br>
            <strong>GST:</strong> 29AAHCB9792J1ZU<br>
            <strong>PAN:</strong> AAHCB9792J<br>
            <strong>State:</strong> Karnataka<br>
            <strong>State Code:</strong> 29
        </div>
    </div>

    <br>

    <div class="row">
        <div class="col">
            <strong>UNIT DETAILS</strong><br><br>
            Name: JAAN CHICKEN'S<br>
            Address: MULLAKADU 4TH MAIL , AKASHBHAVANA  
            Mangalore, Karnataka, India, 575008<br>
            Contact #: 7624985943<br>
            GSTIN: 29AAHCB9792J1ZU<br><br>

            <strong>Bank Details:</strong><br>
            Bank: HDFC Bank Ltd<br>
            Branch: Hampankatta, Mangalore<br>
            A/c No: 99958355555555<br>
            IFSC: HDFC0001571<br>
        </div>

        <div class="col">
            <strong>CONSIGNEE DETAILS</strong><br><br>
            Name: {{ sale.customer.customer_name }}l<br>
            Address: {{ sale.customer.customer_address }}<br>
            Contact #: {{ sale.customer.customer_phone }}<br>
        </div>
    </div>

    <br>

    <table>
        <tr>
            <th>SL No</th>
            <th>ITEM NAME</th>
            <th>QTY</th>
            <th>WEIGHT</th>
            <th>RATE</th>
            <th>AMOUNT</th>
        </tr>
        {% for d in sale.details.all %}
        <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ d.item.name }}</td>
            <td>{{ d.qty|default:"—" }}</td>
            <td>{{ d.net_weight|floatformat:3|default:"—" }}</td>
            <td class="text-right">₹{{ d.price_per_unit|floatformat:2 }}</td>
            <td class="text-right">₹{{ d.total_amount|floatformat:2|intcomma }}</td>
        </tr>
         {% empty %}
        <tr><td colspan="6">No items</td></tr>
        {% endfor %}
    </table>

    <br>

    <table class="totals">
        <tr><td><strong>SUBTOTAL :</strong></td><td>₹{{ sale.total|floatformat:2|intcomma }}</td></tr>
        <tr><td><strong>ROUND OFF :</strong></td><td>₹{{ sale.discount|floatformat:2|intcomma }}</td></tr>
        <tr><td><strong>GRAND TOTAL :</strong></td><td><strong>₹{{ sale.grand_total|floatformat:2|intcomma }}</strong></td></tr>
        <tr><td><strong>Total in Words :</strong></td><td><span id="amountInWords">Loading...</span> Only.</td></tr>
    </table>

    <div class="signature">
        AUTHORIZED SIGNATURE <br><br>
       <input type="text" name="signiture"  style="width: 148pt;height: 24pt;" readonly>
        <br>
        <span style="font-size: 9px;">Certified that the particulars given above are true and correct.</span>
    </div>


</div>
<script>

    // Reliable Indian Rupee to Words Converter
function convertToWords() {
    const amount = parseFloat("{{ sale.grand_total|floatformat:2 }}") || 0;
    if (amount === 0) {
        document.getElementById("amountInWords").textContent = "Zero Rupees";
        return;
    }

    const ones = ["", "One ", "Two ", "Three ", "Four ", "Five ", "Six ", "Seven ", "Eight ", "Nine ", "Ten ",
                "Eleven ", "Twelve ", "Thirteen ", "Fourteen ", "Fifteen ", "Sixteen ", "Seventeen ", "Eighteen ", "Nineteen "];

    const tens = ["", "", "Twenty ", "Thirty ", "Forty ", "Fifty ", "Sixty ", "Seventy ", "Eighty ", "Ninety "];

    function convertLessThanThousand(num) {
        let str = "";
        if (num >= 100) {
            str += ones[Math.floor(num / 100)] + "Hundred ";
            num %= 100;
        }
        if (num >= 20) {
            str += tens[Math.floor(num / 10)];
            num %= 10;
        }
        if (num > 0 && num < 20) {
            str += ones[num];
        }
        return str.trim();
    }

    let rupees = Math.floor(amount);
    let paise = Math.round((amount - rupees) * 100);

    let result = "";

    if (rupees === 0) {
        result = "Zero ";
    } else {
        let crores = Math.floor(rupees / 10000000);
        rupees %= 10000000;
        if (crores > 0) result += convertLessThanThousand(crores) + "Crore ";

        let lakhs = Math.floor(rupees / 100000);
        rupees %= 100000;
        if (lakhs > 0) result += convertLessThanThousand(lakhs) + "Lakh ";

        let thousands = Math.floor(rupees / 1000);
        rupees %= 1000;
        if (thousands > 0) result += convertLessThanThousand(thousands) + "Thousand ";

        if (rupees > 0) result += convertLessThanThousand(rupees);
    }

    result += " Rupees";

    if (paise > 0) {
        result += " and " + convertLessThanThousand(paise) + "Paise";
    }

    document.getElementById("amountInWords").textContent = result.trim();
}

// Run on page load
convertToWords();

window.print();
setTimeout(function(){
    window.location = "{% url 'wholesale_sales_add' %}";
}, 1800)
</script>
</body>
</html>
